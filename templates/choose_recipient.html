{% extends "base.html" %}
{% load staticfiles %}

{% block title %}Jimini - Choose the recipient{% endblock %}

{% block content %}
<div class="workflowNav">
  {% if order_id == None %}
  <a href='/choose_origami.html/{{ origami_id }}'><img class='workflowSteps_grey' src='{% static "website_parts/homepage/step1_half.png" %}'/></a>
  <img class='workflowSteps' src='{% static "website_parts/homepage/step2_half.png" %}'/>
  <img class='workflowSteps_grey' src='{% static "website_parts/homepage/step3_half.png" %}'/>
  {% else %}
  <a href='/choose_origami.html/{{ origami_id }}/{{ order_id }}'><img class='workflowSteps_grey' src='{% static "website_parts/homepage/step1_half.png" %}'/></a>
  <img class='workflowSteps' src='{% static "website_parts/homepage/step2_half.png" %}'/>
  <a href='/payment.html/{{ origami_id }}/{{ order_id }}'><img class='workflowSteps_grey' src='{% static "website_parts/homepage/step3_half.png" %}'/></a>
  {% endif %}
  <img class='workflowSteps_grey' src='{% static "website_parts/homepage/step4_half.png" %}'/>
</div>

	
	<div id="AmazonPayButton"/>
    <script type="text/javascript">
     var authRequest;
     OffAmazonPayments.Button("AmazonPayButton", "A2OSAYU8Y178Y0", {
     type: "PwA",
     useAmazonAddressBook: true,
     authorization: function() {
     loginOptions =
     {scope: "profile payments:widget payments:shipping_address"};
     authRequest = amazon.Login.authorize(loginOptions);
     },
     onSignIn: function(orderReference) {
     // The following OAuth 2 response parameters will be included in
     // the query string when the customer's browser is redirected to
     // the URL below: access_token, token_type, expires_in, and scope.
     authRequest.onComplete("/choose_recipient.html/{{ origami.id }}?session="
     + orderReference.getAmazonOrderReferenceId());
     },
     onError: function(error) {
     // your error handling code
     }
     });
    </script>
    
    <script>
    var wallet = function() {
    new OffAmazonPayments.Widgets.Wallet({
     sellerId: 'A2OSAYU8Y178Y0',
     amazonOrderReferenceId: '{{ amazonOrderReferenceId }}', 
     // amazonOrderReferenceId obtained from Button widget
     design: {
     size : {width:'400px', height:'260px'}
     },
     onPaymentSelect: function(orderReference) {
     // Replace this code with the action that you want to perform
     // after the payment method is selected.
     },
     onError: function(error) {
     // your error handling code
     }
    }).bind("walletWidgetDiv");
    }
    </script>
        
    
    <div id="addressBookWidgetDiv">
    </div> 
    <script>
    new OffAmazonPayments.Widgets.AddressBook({
     sellerId: 'A2OSAYU8Y178Y0',
     amazonOrderReferenceId: '{{ amazonOrderReferenceId }}', 
     // amazonOrderReferenceId obtained from Button widget
     onAddressSelect: function(orderReference) {
     // Replace the following code with the action that you want to perform 
     // after the address is selected.
     // The amazonOrderReferenceId can be used to retrieve 
     // the address details by calling the GetOrderReferenceDetails
     // operation. If rendering the AddressBook and Wallet widgets on the
     // same page, you should wait for this event before you render the
     // Wallet widget for the first time.
     
     wallet();
     
     },
     design: {
     size : {width:'400px', height:'260px'}
     },
     onError: function(error) {
     // your error handling code
     }
    }).bind("addressBookWidgetDiv");
    </script>

    <div id="walletWidgetDiv">
    </div>

	

<div class="RecipientShipping">
  <h3>Select Recipient</h3>
    {% if order_id != None %}
    <form method="post" action="../{{ origami.id }}/{{ order_id }}?session={{ amazonOrderReferenceId }}">
    {% else %}
    <form method="post" action="/choose_recipient.html/{{ origami.id }}?session={{ amazonOrderReferenceId }}">
    {% endif %}{% csrf_token %}
      <span class="formlabel">To: </span><br>
      <span class='error'>{{ form.recipient_name.errors }}</span>
      <span id="recipient_name">{{ form.recipient_name }}</span><br>
      <span class="formlabel">From: </span><br>
      <span class='error'>{{ form.sender_name.errors }}</span>
      <span id="recipient_name">{{ form.sender_name }}</span><br>
      <span class="formlabel">Message</span><br>
      <span class='error'>{{ form.message.errors }}</span>
      <span id="message">{{ form.message }}</span>
    <br>
    <h3>Shipping Address</h3>
    <table>
      <tr>
	<td class="formlabel">Full name</td>
	<td id="ship_to_name">{{ form.ship_to_name }}</td>
	<td class='error'>{{ form.ship_to_name.errors }}</td>
      </tr>
      <tr>
	<td class="formlabel">Address</td>
	<td id="ship_to_address">{{ form.ship_to_address }}</td>
	<td class='error'>{{ form.ship_to_address.errors }}</td>
      </tr>
      <tr>
	<td class="formlabel">City</td>
	<td id="ship_to_address">{{ form.city }}</td>
	<td class='error'>{{ form.city.errors }}</td>
      </tr>
      <tr>
	<td class="formlabel">State</td>
	<td id="ship_to_address">{{ form.state }}</td>
	<td class='error'>{{ form.state.errors }}</td>
      </tr>
      <tr>
	<td class="formlabel">Zip code</td>
	<td id="ship_to_address">{{ form.zip_code }}</td>
	<td class='error'>{{ form.zip_code.errors }}</td>
      </tr>
      <tr>
	<td>
	  {% if order_id == None %}
	  <a href="/choose_origami.html/{{ origami_id }}">Back</a>
	  {% else %}
	  <a href="/choose_origami.html/{{ origami_id }}/{{ order_id }}">Back</a>
	  {% endif %}
	</td>
	<td><input type="submit" value="Save and Continue"></td>
      </tr>
      </table>
  </form>
</div>

  <div class="checkoutOrigamiDisplay">
          <h3 class="origamiTitle">{{ origami.title }}</h3>
	  <img src='{{ origami.get_pictures.0.picture.url }}'/>
	  <h2>Price: ${{ origami.price }}</h2>
          <p>{{ origami.description }}</p>
  </div>


</div>

{% endblock %}
